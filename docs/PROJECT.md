# LLM 기반 확장 가능한 AI 성격 제어 시스템
[프로젝트 기획서]

---

## 0. 프로젝트 한 줄 정의
- 프롬프트가 아닌 모델 파라미터 차이(personality vector)로 성격을 정의하고 α 스케일링과 모델 병합으로 성격 강도/조합을 연속적으로 제어하는 시스템을 설계한다.

---

## 1. 배경 및 문제 정의
- 대화형 AI 개인화 요구가 “무엇을 말하느냐”에서 “어떻게 말하느냐(성격/행동)”로 이동하고 있다.
- 프롬프트 기반 성격 설정은 제품 관점에서 품질 관리가 어렵다.
  - 일관성 저하: 대화가 길어질수록 성격 톤이 흔들림
  - 재현성 저하: 프롬프트, 컨텍스트 길이, 모델 업데이트에 민감
  - 확장성 제한: 사용자 조절 UI(설정/슬라이더)로 안정적으로 매핑하기 어려움
- 따라서 사용자가 직접 조절 가능한 수준으로 구조적으로 정의되어 확장 가능한 성격 제어 방식이 필요하다.

---

## 2. 목표 및 성공 기준

### 목표
- LLM의 성격이라는 추상적 개념을 모델 파라미터 델타(personality vector)로 정의하고 성격을 시스템 레벨에서 제어 가능한 형태로 만든다.
- Task Arithmetic 기반 병합(θ = θ_base + α · ϕ)을 통해 성격 강도를 연속적으로 조절하는 메커니즘을 구현하고 동일 설정에서 결과가 재현되는지 확인한다.

### 성공 기준
- 강도 제어: α 값 변화에 따라 성격 지표가 단조롭게(연속적으로) 변화해야 한다.
- 일관성/재현성: 동일 프롬프트/설정에서 성격 지표 및 응답 스타일의 경향이 반복되어야 한다.
- 품질 유지: 성격이 부여된 채로 대화 진행 시, 일반 성능이 과도하게 훼손되지 않아야 한다.

---

## 3. 제품 시나리오
- 시스템은 사용자의 설정값을 α와 병합 레시피로 변환한다.
- 대화 중에도 성격 톤이 유지되며, 설정 변경 시 즉시 반영된다.
- 단일 성격뿐 아니라 다중 조합(예: 친화적이지만 내향적)도 제공 가능해야 한다.

---

## 4. 해결 전략
### 핵심 기능 정의
- F1. 성격 벡터 정의
  - 성격 특화 모델과 베이스 모델의 파라미터 차이를 personality vector로 정의한다.
- F2. 강도 조절
  - α 스케일링으로 성격 표현 세기를 연속적으로 조절한다.
- F3. 다중 조합
  - 여러 trait의 personality vector를 병합하여 다차원 성격을 구성한다.

### 병합 레시피(merge recipe) 설계 원칙
- 단일 trait은 기본 병합식으로 충분하다.
- 다중 trait은 간섭(interference)이 발생할 수 있으므로 간섭 완화 레시피를 적용한다.

---

## 5. 시스템 설계
### 시스템 구성
- 입력: base model(Llama-3.1-8B-Instruct), trait-tuned model(s), α, 병합 방법, output_dir
- 처리:
  - personality vector 계산(델타)
  - α 적용(스케일링)
  - 단일/다중 병합
  - 병합 모델 저장
- 출력: 병합된 모델 체크포인트

### 리포 구조(현재 기준)
- model_merge/
  - 병합 파이프라인 및 merging methods
- interview/
  - 성격 발현 확인용 프롬프트/테스트 스크립트
- image/
  - 아키텍처 이미지

---

## 6. 실행 계획 (Plan)
### 단계 1: 벡터 생성 및 단일 성격 제어 검증
- trait별 fine-tuned 모델 준비
- personality vector 생성
- α 범위 스윕으로 연속 제어 성립 여부 확인

### 단계 2: 다중 조합 및 간섭 리스크 처리
- 다중 trait 동시 병합
- 간섭(interference) 발생 여부 확인
- 간섭 완화 레시피 적용 및 비교 (DaRE/TIES-Merging)

### 단계 3: 평가 체계 구축 및 결과 정리
- 성격 발현 평가: 인터뷰 기반 프롬프트 + 성격 지표 스코어링 (BFI)
- 언어적 특징 분석: 스타일 변화 확인용 특징 분석 (LIWC-22)
- 품질 가드레일 평가: 지시 따르기 등 일반 성능 유지 여부 확인 (ALPACAEVAL)
- 결과를 재현 가능하게 문서화(설정, 스크립트, 출력 경로 규칙)

---

## 7. 검증 설계 (Validation)
- RQ1: α로 성격 강도를 연속적으로 조절할 수 있는가?
- RQ2: 다중 성격을 조합해도 목표 방향성이 유지되는가?
- RQ3: 다중 조합에서 발생하는 간섭을 레시피로 완화할 수 있는가?
- RQ4: 성격 제어가 일반 성능을 과도하게 훼손하지 않는가?

---

## 8. 리스크 및 대응 (Risks)
- 다중 벡터 병합 시 간섭으로 제어력 저하 가능
  - 대응: 간섭 완화 레시피 적용, 설정값 상한
- 성격 극단값에서 공격적/불안정한 톤 발생 가능
  - 대응: 성격 병합 범위 제한
- 병합 과정에서 수치 불안정(NaN/붕괴) 발생 가능
  - 대응: 안정 구간 탐색, 실패 케이스 로그/가드레일, 저장 규칙 표준화

---

## 9. 산출물 (Deliverables)
- 병합 파이프라인 코드 및 실행 스크립트
- 성격 발현 테스트 스크립트 및 로그 산출물
- 성격 부여된 모델들
- 성격별 LIWC-22 결과 산출물

---

## 10. 역할
- 문제를 제품 품질 관점(일관성/재현성/확장성)으로 정의하고 해결 방향을 시스템 구조로 설계했다.
- 성격을 설정 가능한 기능으로 만들기 위해 벡터 정의, 강도 조절, 다중 조합 기능을 스펙으로 정의했다.
- 간섭/안정성/안전 이슈를 리스크로 명시하고 레시피 및 정책(상한/제한)으로 대응 전략을 설계했다.
- 실험을 기능 검증으로 보고, 검증 질문(RQ)과 평가 체계를 설계해 결과를 재현 가능하게 정리했다.

---

## 11. 관찰 및 한계 (Limitation)
- 벡터를 음수 방향으로 적용하는 negation(θ = θ_base − α · ϕ)을 탐색했으나, 성격 신호만 선택적으로 제거된다기보다 모델의 전반적 능력 저하가 함께 나타나는 경향을 관찰했다.
- 따라서 negation은 “성격 제거 기능”으로 정의하기보다, 모델 파라미터 델타 적용이 전반적 성능에 미칠 수 있는 영향에 대한 관찰로만 기술한다.
